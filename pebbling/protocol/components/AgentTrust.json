{
  "$defs": {
    "IdentityProvider": {
      "description": "Supported identity providers",
      "enum": [
        "keycloak",
        "azure_ad",
        "okta",
        "auth0",
        "custom"
      ],
      "title": "IdentityProvider",
      "type": "string"
    },
    "KeycloakRole": {
      "description": "Keycloak role model",
      "properties": {
        "role_id": {
          "description": "Role ID from Keycloak IAM.",
          "format": "uuid",
          "title": "Role Id",
          "type": "string"
        },
        "role_name": {
          "description": "Human-readable role name.",
          "title": "Role Name",
          "type": "string"
        },
        "permissions": {
          "description": "Specific permissions tied to this role.",
          "items": {
            "type": "string"
          },
          "title": "Permissions",
          "type": "array"
        },
        "trust_level": {
          "$ref": "#/$defs/TrustLevel",
          "default": "medium",
          "description": "Default trust level for this role"
        },
        "realm_name": {
          "description": "The Keycloak realm this role belongs to.",
          "title": "Realm Name",
          "type": "string"
        },
        "external_mappings": {
          "anyOf": [
            {
              "additionalProperties": {
                "type": "string"
              },
              "type": "object"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Mappings to equivalent roles in other identity systems",
          "title": "External Mappings"
        },
        "operation_permissions": {
          "anyOf": [
            {
              "additionalProperties": {
                "$ref": "#/$defs/TrustLevel"
              },
              "type": "object"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "Operation-specific trust requirements, e.g., {'update_customer': 'high'}",
          "title": "Operation Permissions"
        }
      },
      "required": [
        "role_id",
        "role_name",
        "realm_name"
      ],
      "title": "KeycloakRole",
      "type": "object"
    },
    "TrustLevel": {
      "description": "Trust levels for operations and permissions",
      "enum": [
        "untrusted",
        "minimal",
        "low",
        "standard",
        "medium",
        "high",
        "elevated",
        "critical",
        "super-critical",
        "emergency"
      ],
      "title": "TrustLevel",
      "type": "string"
    }
  },
  "description": "Trust configuration for an agent",
  "properties": {
    "identity_provider": {
      "$ref": "#/$defs/IdentityProvider",
      "description": "Identity provider used for authentication"
    },
    "inherited_roles": {
      "description": "Roles inherited from the agent's creator",
      "items": {
        "$ref": "#/$defs/KeycloakRole"
      },
      "title": "Inherited Roles",
      "type": "array",
      "default": []
    },
    "certificate": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "description": "Agent's security certificate for verification",
      "title": "Certificate"
    },
    "certificate_fingerprint": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "description": "Fingerprint of the agent's certificate",
      "title": "Certificate Fingerprint"
    },
    "creator_id": {
      "anyOf": [
        {
          "format": "uuid",
          "type": "string"
        },
        {
          "type": "integer"
        },
        {
          "type": "string"
        }
      ],
      "description": "ID of the user who created this agent",
      "title": "Creator Id"
    },
    "creation_timestamp": {
      "description": "ISO-8601 timestamp of agent creation",
      "examples": [
        "2023-10-27T10:00:00Z"
      ],
      "title": "Creation Timestamp",
      "type": "string"
    },
    "trust_verification_required": {
      "default": true,
      "description": "Whether trust verification is required",
      "title": "Trust Verification Required",
      "type": "boolean"
    },
    "allowed_operations": {
      "additionalProperties": {
        "$ref": "#/$defs/TrustLevel"
      },
      "description": "Operations this agent is allowed to perform with required trust levels",
      "title": "Allowed Operations",
      "type": "object",
      "default": {}
    }
  },
  "required": [
    "identity_provider",
    "creator_id",
    "creation_timestamp"
  ],
  "title": "AgentTrust",
  "type": "object"
}